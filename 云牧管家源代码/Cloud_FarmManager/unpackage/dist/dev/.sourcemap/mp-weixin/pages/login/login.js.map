{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../../HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-container\">\r\n\t\t<!-- 头部 -->\r\n\t\t<view class=\"header\">\r\n\t\t\t<view class=\"logo\">\r\n\t\t\t\t<image src=\"/static/icons/logo.png\" mode=\"aspectFit\"></image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"title\">云牧管家</view>\r\n\t\t\t<view class=\"subtitle\">智慧养殖，云端管理</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 表单容器 -->\r\n\t\t<view class=\"form-container\">\r\n\t\t\t<!-- 选项卡 -->\r\n\t\t\t<view class=\"tab-bar\">\r\n\t\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'login' }\" @click=\"currentTab = 'login'\">\r\n\t\t\t\t\t登录\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"tab-item\" :class=\"{ active: currentTab === 'register' }\" @click=\"currentTab = 'register'\">\r\n\t\t\t\t\t注册\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 登录表单 -->\r\n\t\t\t<view v-if=\"currentTab === 'login'\" class=\"form\">\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">用户名</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"text\" v-model=\"loginForm.username\" placeholder=\"请输入用户名\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">密码</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"password\" v-model=\"loginForm.password\" placeholder=\"请输入密码\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<button class=\"submit-button\" :disabled=\"loginLoading\" @click=\"handleLogin\">\r\n\t\t\t\t\t{{ loginLoading ? '登录中...' : '登录' }}\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 注册表单 -->\r\n\t\t\t<view v-if=\"currentTab === 'register'\" class=\"form\">\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">用户名</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"text\" v-model=\"registerForm.username\" placeholder=\"请输入用户名\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">密码</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"password\" v-model=\"registerForm.password\" placeholder=\"请输入密码\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">确认密码</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"password\" v-model=\"registerForm.confirmPassword\" placeholder=\"请再次输入密码\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t<view class=\"input-label\">昵称</view>\r\n\t\t\t\t\t<input class=\"input-field\" type=\"text\" v-model=\"registerForm.nickname\" placeholder=\"请输入昵称（可选）\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<button class=\"submit-button\" :disabled=\"registerLoading\" @click=\"handleRegister\">\r\n\t\t\t\t\t{{ registerLoading ? '注册中...' : '注册' }}\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 跳过登录 -->\r\n\t\t<view class=\"skip-login\" @click=\"skipLogin\">\r\n\t\t\t暂不登录，继续浏览\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { useCartStore } from '@/stores/cart.js'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\t// 初始化购物车store\r\n\t\tthis.cartStore = useCartStore();\r\n\t\t\r\n\t\treturn {\r\n\t\t\tcurrentTab: 'login',\r\n\t\t\tloginForm: {\r\n\t\t\t\tusername: '',\r\n\t\t\t\tpassword: ''\r\n\t\t\t},\r\n\t\t\tregisterForm: {\r\n\t\t\t\tusername: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tconfirmPassword: '',\r\n\t\t\t\tnickname: ''\r\n\t\t\t},\r\n\t\t\tloginLoading: false,\r\n\t\t\tregisterLoading: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync handleLogin() {\r\n\t\t\tif (!this.loginForm.username || !this.loginForm.password) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请填写完整信息',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.loginLoading = true;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-auth',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'login',\r\n\t\t\t\t\t\tusername: this.loginForm.username,\r\n\t\t\t\t\t\tpassword: this.loginForm.password\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconsole.log('登录云函数返回结果:', result.result);\r\n\r\n\t\t\t\tif (result.result.errCode === 0) {\r\n\t\t\t\t\t// 保存用户信息\r\n\t\t\t\t\tuni.setStorageSync('userToken', result.result.token);\r\n\t\t\t\t\tif (result.result.userInfo) {\r\n\t\t\t\t\t\tuni.setStorageSync('userInfo', result.result.userInfo);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.setStorageSync('userInfo', {\r\n\t\t\t\t\t\t\tusername: this.loginForm.username,\r\n\t\t\t\t\t\t\tuserId: result.result.userId || ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 通知购物车切换用户\r\n\t\t\tthis.cartStore.switchUser();\r\n\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/shopping/shopping'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 1500);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: result.result.errMsg,\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('登录失败:', error);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '登录失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loginLoading = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync handleRegister() {\r\n\t\t\tif (!this.registerForm.username || !this.registerForm.password || !this.registerForm.confirmPassword) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请填写完整信息',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.registerForm.password !== this.registerForm.confirmPassword) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '两次密码不一致',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.registerForm.password.length < 6) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '密码至少6位',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.registerLoading = true;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-auth',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'register',\r\n\t\t\t\t\t\tusername: this.registerForm.username,\r\n\t\t\t\t\t\tpassword: this.registerForm.password,\r\n\t\t\t\t\t\tnickname: this.registerForm.nickname || this.registerForm.username\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (result.result.errCode === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '注册成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 清空注册表单\r\n\t\t\t\t\tObject.assign(this.registerForm, {\r\n\t\t\t\t\t\tusername: '',\r\n\t\t\t\t\t\tpassword: '',\r\n\t\t\t\t\t\tconfirmPassword: '',\r\n\t\t\t\t\t\tnickname: ''\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 切换到登录页面\r\n\t\t\t\t\tthis.currentTab = 'login';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: result.result.errMsg,\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('注册失败:', error);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '注册失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.registerLoading = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tskipLogin() {\r\n\t\t\tuni.switchTab({\r\n\t\t\t\turl: '/pages/shopping/shopping'\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-container {\r\n\tmin-height: 100vh;\r\n\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\tpadding: 60rpx 40rpx;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.header {\r\n\ttext-align: center;\r\n\tmargin-bottom: 80rpx;\r\n}\r\n\r\n.logo {\r\n\twidth: 120rpx;\r\n\theight: 120rpx;\r\n\tmargin: 0 auto 30rpx;\r\n\tborder-radius: 50%;\r\n\tbackground: rgba(255, 255, 255, 0.2);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n}\r\n\r\n.logo image {\r\n\twidth: 80rpx;\r\n\theight: 80rpx;\r\n}\r\n\r\n.title {\r\n\tfont-size: 48rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #fff;\r\n\tmargin-bottom: 10rpx;\r\n}\r\n\r\n.subtitle {\r\n\tfont-size: 28rpx;\r\n\tcolor: rgba(255, 255, 255, 0.8);\r\n}\r\n\r\n.form-container {\r\n\tbackground: rgba(255, 255, 255, 0.95);\r\n\tborder-radius: 20rpx;\r\n\tpadding: 40rpx;\r\n\tmargin-bottom: 40rpx;\r\n\tbackdrop-filter: blur(10px);\r\n}\r\n\r\n.tab-bar {\r\n\tdisplay: flex;\r\n\tmargin-bottom: 40rpx;\r\n\tbackground: #f5f5f5;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 6rpx;\r\n}\r\n\r\n.tab-item {\r\n\tflex: 1;\r\n\ttext-align: center;\r\n\tpadding: 20rpx;\r\n\tborder-radius: 8rpx;\r\n\tfont-size: 32rpx;\r\n\tcolor: #666;\r\n\ttransition: all 0.3s;\r\n}\r\n\r\n.tab-item.active {\r\n\tbackground: #667eea;\r\n\tcolor: #fff;\r\n}\r\n\r\n.form {\r\n\tmargin-top: 20rpx;\r\n}\r\n\r\n.input-group {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.input-label {\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tmargin-bottom: 10rpx;\r\n\tfont-weight: 500;\r\n}\r\n\r\n.input-field {\r\n\twidth: 100%;\r\n\theight: 88rpx;\r\n\tborder: 2rpx solid #e0e0e0;\r\n\tborder-radius: 10rpx;\r\n\tpadding: 0 20rpx;\r\n\tfont-size: 30rpx;\r\n\tbackground: #fff;\r\n\ttransition: border-color 0.3s;\r\n}\r\n\r\n.input-field:focus {\r\n\tborder-color: #667eea;\r\n}\r\n\r\n.submit-button {\r\n\twidth: 100%;\r\n\theight: 88rpx;\r\n\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\tcolor: #fff;\r\n\tborder: none;\r\n\tborder-radius: 10rpx;\r\n\tfont-size: 32rpx;\r\n\tfont-weight: 500;\r\n\tmargin-top: 20rpx;\r\n}\r\n\r\n.submit-button:disabled {\r\n\topacity: 0.6;\r\n}\r\n\r\n.skip-login {\r\n\ttext-align: center;\r\n\tcolor: rgba(255, 255, 255, 0.8);\r\n\tfont-size: 28rpx;\r\n\tpadding: 20rpx;\r\n\ttext-decoration: underline;\r\n}\r\n</style>","import MiniProgramPage from 'D:/前端开发/云养丝路/云牧管家测试/Cloud_FarmManager/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCartStore","uni","uniCloud"],"mappings":"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"}