{"version":3,"file":"shopping.js","sources":["pages/shopping/shopping.vue","../../../../HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2hvcHBpbmcvc2hvcHBpbmcudnVl"],"sourcesContent":["<template>\n\t<view class=\"page-container\">\n\t\t<!-- 商城标题栏 -->\n\t\t<view class=\"shop-header\">\n\t\t\t<text class=\"shop-title\">瑶山好物</text>\n\t\t\t<text class=\"shop-slogan\">源自山野，健康自然</text>\n\t\t</view>\n\n\t\t<view class=\"content\">\n\t\t\t<!-- 搜索栏 -->\n\t\t\t<SearchInputVue placeholderText=\"搜索农产品,瑶族特产\"></SearchInputVue>\n\n\t\t\t<!-- 分类标签 -->\n\t\t\t<scroll-view class=\"category-tabs\" scroll-x=\"true\" show-scrollbar=\"false\">\n\t\t\t\t<view class=\"category-tab active\">全部</view>\n\t\t\t\t<view class=\"category-tab\">农产品</view>\n\t\t\t\t<view class=\"category-tab\">瑶族特产</view>\n\t\t\t\t<view class=\"category-tab\">手工艺品</view>\n\t\t\t\t<view class=\"category-tab\">礼品套装</view>\n\t\t\t\t<view class=\"category-tab\">茶饮</view>\n\t\t\t</scroll-view>\n\n\t\t\t<!-- 筛选栏 -->\n\t\t\t<view class=\"filter-bar\">\n\t\t\t\t<view class=\"filter-option\">\n\t\t\t\t\t<text>综合排序</text>\n\t\t\t\t\t<image src=\"/static/icons/shopping icon/chevron-down.svg\"></image>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"filter-option\">\n\t\t\t\t\t<text>销量优先</text>\n\t\t\t\t\t<image src=\"/static/icons/shopping icon/chevron-down.svg\"></image>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"filter-option\">\n\t\t\t\t\t<text>筛选</text>\n\t\t\t\t\t<image src=\"/static/icons/shopping icon/筛选.svg\"></image>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 商品列表 -->\n\t\t\t<view class=\"product-grid\">\n\t\t\t\t<!-- 加载状态 -->\n\t\t\t\t<view v-if=\"loading\" class=\"loading-container\">\n\t\t\t\t\t<text class=\"loading-text\">正在加载商品...</text>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 商品 -->\n\t\t\t\t<ProductCardVue v-for=\"product in products\" :key=\"product.id\" :product=\"product\" @click=\"goToProductDetail\"\n\t\t\t\t\t@addToCart=\"addToCart\"></ProductCardVue>\n\t\t\t\t\n\t\t\t\t<!-- 空状态 -->\n\t\t\t\t<view v-if=\"!loading && products.length === 0\" class=\"empty-container\">\n\t\t\t\t\t<text class=\"empty-text\">暂无商品</text>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 购物车浮动按钮 -->\n\t\t\t\t<view class=\"cart-fab\" @click=\"goToCart()\">\n\t\t\t\t\t<image src=\"/static/icons/shopping icon/shopping-cart-fill.svg\"></image>\n\t\t\t\t\t<text class=\"badge\" v-if=\"cartTotalCount > 0\">{{cartTotalCount}}</text>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 底部导航栏 -->\n\t\t\t\t<!-- <tab-bar active=\"shopping\"></tab-bar> -->\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport SearchInputVue from '../../components/SearchInput.vue';\n\timport ProductCardVue from '../../components/ProductCard.vue';\n\timport { ref, onMounted, onUnmounted, computed } from 'vue';\n\timport { getAllProducts } from '../../api/productService.js';\n\timport { useCartStore } from '../../stores/cart.js';\n\t\n\t// 使用Pinia购物车store\n\tconst cartStore = useCartStore();\n\t// 使用计算属性获取购物车总数，自动响应式更新\n\tconst cartTotalCount = computed(() => cartStore.totalCount);\n\t\n\t// 使用新的商品数据管理系统 - 改为异步加载\n\tconst products = ref([]);\n\tconst loading = ref(true);\n\n\t// 页面加载时初始化购物车数量和商品数据\n\tonMounted(async () => {\n\t\t// 检查用户状态并切换购物车数据\n\t\tcartStore.switchUser();\n\t\t// 监听购物车更新事件\n\t\tuni.$on('cartUpdated', handleCartUpdate);\n\t\t\n\t\t// 异步加载商品数据\n\t\tawait loadProducts();\n\t});\n\n\t// 加载商品数据\n\tconst loadProducts = async () => {\n\t\ttry {\n\t\t\tloading.value = true;\n\t\t\tconst productList = await getAllProducts();\n\t\t\tproducts.value = productList;\n\t\t} catch (error) {\n\t\t\tconsole.error('加载商品数据失败:', error);\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '加载商品失败',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t} finally {\n\t\t\tloading.value = false;\n\t\t}\n\t};\n\n\t// 页面卸载时移除事件监听\n\tonUnmounted(() => {\n\t\tuni.$off('cartUpdated', handleCartUpdate);\n\t});\n\n\t// 处理购物车更新事件\n\tconst handleCartUpdate = (cartData) => {\n\t\t// 由于使用了计算属性，这里不需要手动更新\n\t\t// cartTotalCount会自动响应cartStore的变化\n\t};\n\n\tconst goToProductDetail = (productId) => {\n\t\tuni.navigateTo({\n\t\t\turl: `/pages/shopping/detail/detail?id=${productId}`\n\t\t});\n\t};\n\n\tconst addToCart = (productId) => {\n\t\t// 根据商品ID找到商品信息\n\t\tconst product = products.value.find(p => p.id === productId);\n\t\tif (product) {\n\t\t\t// 添加到购物车\n\t\t\tconst success = cartStore.addToCart(product, 1);\n\t\t\tif (success) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '已加入购物车',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tconst goToCart = () => {\n\t\tuni.navigateTo({\n\t\t\turl: '/pages/shopping/cart/cart'\n\t\t});\n\t};\n</script>\n\n<style lang=\"scss\">\n\t@import '@/uni.scss';\n\n\tpage {\n\t\tbackground-color: $color-secondary;\n\t}\n\n\t/* 页面容器 */\n\t.page-container {\n\t\tpadding-bottom: 50px;\n\t\t/* 为原生tabBar留出空间 */\n\t\twidth: 100%;\n\t\tbox-sizing: border-box;\n\t}\n\n\t/* 商城标题栏 */\n\t.shop-header {\n\t\tbackground-color: $color-accent;\n\t\tpadding: 30rpx;\n\t\tmargin-bottom: 30rpx;\n\t\tborder-radius: 0 0 30rpx 30rpx;\n\t}\n\n\t.shop-title {\n\t\tfont-weight: 600;\n\t\tfont-size: 36rpx;\n\t\tcolor: $color-dark;\n\t\tdisplay: block;\n\t\tmargin-bottom: 10rpx;\n\t}\n\n\t.shop-slogan {\n\t\tfont-size: 28rpx;\n\t\tcolor: $color-dark;\n\t\topacity: 0.8;\n\t\tdisplay: block;\n\t}\n\n\t/* 内容区域 */\n\t.content {\n\t\tpadding: 0 30rpx 30rpx;\n\t}\n\n\t/* 分类标签 */\n\t.category-tabs {\n\t\tdisplay: flex;\n\t\twhite-space: nowrap;\n\t\tborder-bottom: 1px solid rgba(94, 100, 114, 0.1);\n\t\tmargin-bottom: 30rpx;\n\t\tpadding: 0 10rpx;\n\t}\n\n\t.category-tab {\n\t\tpadding: 24rpx 30rpx;\n\t\tmargin: 0 10rpx;\n\t\tfont-size: 30rpx;\n\t\tfont-weight: 500;\n\t\tcolor: $color-dark;\n\t\tdisplay: inline-block;\n\t\tborder-bottom: 6rpx solid transparent;\n\t\ttransition: all 0.3s ease;\n\t}\n\n\t.category-tab.active {\n\t\tcolor: $color-primary;\n\t\tborder-bottom-color: $color-primary;\n\t}\n\n\t/* 筛选栏 */\n\t.filter-bar {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tmargin-bottom: 30rpx;\n\t\tpadding: 10rpx 0;\n\t}\n\n\t.filter-option {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tfont-size: 26rpx;\n\t\tcolor: $color-dark;\n\t}\n\n\t.filter-option image {\n\t\twidth: 24rpx;\n\t\theight: 24rpx;\n\t\tmargin-left: 10rpx;\n\t\tvertical-align: middle;\n\t}\n\n\t.filter-option .iconfont {\n\t\tmargin-left: 6rpx;\n\t\tfont-size: 24rpx;\n\t}\n\n\t.icon-icon {\n\t\twidth: 32rpx;\n\t\theight: 32rpx;\n\t\tdisplay: inline-block;\n\t}\n\n\t/* 商品网格 */\n\t.product-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: 1fr 1fr;\n\t\tgap: 30rpx;\n\t\tpadding-bottom: 40rpx;\n\t}\n\n\t/* 购物车浮动按钮 */\n\t.cart-fab {\n\t\tposition: fixed;\n\t\tbottom: 160rpx;\n\t\tright: 40rpx;\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t\tbackground-color: $color-primary;\n\t\tcolor: white;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbox-shadow: 0 3px 10px rgba(255, 166, 158, 0.4);\n\t\tz-index: 10;\n\t\tfont-size: 40rpx;\n\t}\n\n\t.cart-fab image {\n\t\twidth: 48rpx;\n\t\theight: 48rpx;\n\t}\n\n\t.cart-fab .badge {\n\t\tposition: absolute;\n\t\ttop: -10rpx;\n\t\tright: -10rpx;\n\t\tbackground-color: $color-dark;\n\t\tcolor: white;\n\t\tfont-size: 20rpx;\n\t\twidth: 36rpx;\n\t\theight: 36rpx;\n\t\tborder-radius: 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\n\t/* 加载状态 */\n\t.loading-container {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 100%;\n\t}\n\n\t.loading-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: $color-dark;\n\t}\n\n\t/* 空状态 */\n\t.empty-container {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 100%;\n\t}\n\n\t.empty-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: $color-dark;\n\t}\n</style>","import MiniProgramPage from 'D:/前端开发/云养丝路/云牧管家测试/Cloud_FarmManager/pages/shopping/shopping.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCartStore","computed","ref","onMounted","uni","getAllProducts","onUnmounted","MiniProgramPage"],"mappings":";;;;;;;;AAoEC,MAAM,iBAAiB,MAAW;AAClC,MAAM,iBAAiB,MAAW;;;;AAMlC,UAAM,YAAYA,YAAAA;AAElB,UAAM,iBAAiBC,cAAQ,SAAC,MAAM,UAAU,UAAU;AAG1D,UAAM,WAAWC,kBAAI,CAAA,CAAE;AACvB,UAAM,UAAUA,kBAAI,IAAI;AAGxBC,kBAAAA,UAAU,YAAY;AAErB,gBAAU,WAAU;AAEpBC,oBAAAA,MAAI,IAAI,eAAe,gBAAgB;AAGvC,YAAM,aAAY;AAAA,IACpB,CAAE;AAGD,UAAM,eAAe,YAAY;AAChC,UAAI;AACH,gBAAQ,QAAQ;AAChB,cAAM,cAAc,MAAMC,mBAAAA;AAC1B,iBAAS,QAAQ;AAAA,MACjB,SAAQ,OAAO;AACfD,sBAAc,MAAA,MAAA,SAAA,sCAAA,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AAAA,MACJ,UAAY;AACT,gBAAQ,QAAQ;AAAA,MAChB;AAAA,IACH;AAGCE,kBAAAA,YAAY,MAAM;AACjBF,oBAAAA,MAAI,KAAK,eAAe,gBAAgB;AAAA,IAC1C,CAAE;AAGD,UAAM,mBAAmB,CAAC,aAAa;AAAA,IAGxC;AAEC,UAAM,oBAAoB,CAAC,cAAc;AACxCA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,oCAAoC,SAAS;AAAA,MACrD,CAAG;AAAA,IACH;AAEC,UAAM,YAAY,CAAC,cAAc;AAEhC,YAAM,UAAU,SAAS,MAAM,KAAK,OAAK,EAAE,OAAO,SAAS;AAC3D,UAAI,SAAS;AAEZ,cAAM,UAAU,UAAU,UAAU,SAAS,CAAC;AAC9C,YAAI,SAAS;AACZA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,MACD;AAAA,IACH;AAEC,UAAM,WAAW,MAAM;AACtBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACR,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClJA,GAAG,WAAWG,SAAe;"}