{"version":3,"file":"cart.js","sources":["store/cart.js"],"sourcesContent":["// 购物车状态管理\nclass CartStore {\n\tconstructor() {\n\t\tthis.cartItems = [];\n\t\tthis.loadCartFromStorage();\n\t}\n\n\t// 从本地存储加载购物车数据\n\tloadCartFromStorage() {\n\t\ttry {\n\t\t\tconst cartData = uni.getStorageSync('cart_items');\n\t\t\tif (cartData) {\n\t\t\t\tthis.cartItems = JSON.parse(cartData);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('加载购物车数据失败:', error);\n\t\t\tthis.cartItems = [];\n\t\t}\n\t}\n\n\t// 保存购物车数据到本地存储\n\tsaveCartToStorage() {\n\t\ttry {\n\t\t\tuni.setStorageSync('cart_items', JSON.stringify(this.cartItems));\n\t\t} catch (error) {\n\t\t\tconsole.error('保存购物车数据失败:', error);\n\t\t}\n\t}\n\n\t// 添加商品到购物车\n\taddToCart(product, quantity = 1, specs = '默认规格') {\n\t\tconst existingItemIndex = this.cartItems.findIndex(item => \n\t\t\titem.id === product.id && item.specs === specs\n\t\t);\n\n\t\tif (existingItemIndex !== -1) {\n\t\t\t// 如果商品已存在，增加数量\n\t\t\tthis.cartItems[existingItemIndex].quantity += quantity;\n\t\t} else {\n\t\t\t// 如果商品不存在，添加新商品\n\t\t\tconst cartItem = {\n\t\t\t\tid: product.id,\n\t\t\t\tname: product.name,\n\t\t\t\tprice: product.price,\n\t\t\t\timage: product.image,\n\t\t\t\tspecs: specs,\n\t\t\t\tquantity: quantity,\n\t\t\t\tselected: true\n\t\t\t};\n\t\t\tthis.cartItems.push(cartItem);\n\t\t}\n\n\t\tthis.saveCartToStorage();\n\t\tthis.notifyCartUpdate();\n\t\t\n\t\treturn true;\n\t}\n\n\t// 更新商品数量\n\tupdateQuantity(index, quantity) {\n\t\tif (index >= 0 && index < this.cartItems.length) {\n\t\t\tif (quantity <= 0) {\n\t\t\t\tthis.removeItem(index);\n\t\t\t} else {\n\t\t\t\tthis.cartItems[index].quantity = quantity;\n\t\t\t\tthis.saveCartToStorage();\n\t\t\t\tthis.notifyCartUpdate();\n\t\t\t}\n\t\t}\n\t}\n\n\t// 切换商品选中状态\n\ttoggleItemSelect(index) {\n\t\tif (index >= 0 && index < this.cartItems.length) {\n\t\t\tthis.cartItems[index].selected = !this.cartItems[index].selected;\n\t\t\tthis.saveCartToStorage();\n\t\t\tthis.notifyCartUpdate();\n\t\t}\n\t}\n\n\t// 移除商品\n\tremoveItem(index) {\n\t\tif (index >= 0 && index < this.cartItems.length) {\n\t\t\tthis.cartItems.splice(index, 1);\n\t\t\tthis.saveCartToStorage();\n\t\t\tthis.notifyCartUpdate();\n\t\t}\n\t}\n\n\t// 清空购物车\n\tclearCart() {\n\t\tthis.cartItems = [];\n\t\tthis.saveCartToStorage();\n\t\tthis.notifyCartUpdate();\n\t}\n\n\t// 全选/取消全选\n\ttoggleSelectAll() {\n\t\tconst allSelected = this.cartItems.every(item => item.selected);\n\t\tthis.cartItems.forEach(item => {\n\t\t\titem.selected = !allSelected;\n\t\t});\n\t\tthis.saveCartToStorage();\n\t\tthis.notifyCartUpdate();\n\t}\n\n\t// 获取购物车商品总数\n\tgetTotalCount() {\n\t\treturn this.cartItems.reduce((total, item) => total + item.quantity, 0);\n\t}\n\n\t// 获取选中商品总数\n\tgetSelectedCount() {\n\t\treturn this.cartItems\n\t\t\t.filter(item => item.selected)\n\t\t\t.reduce((total, item) => total + item.quantity, 0);\n\t}\n\n\t// 获取选中商品总价\n\tgetSelectedTotalPrice() {\n\t\treturn this.cartItems\n\t\t\t.filter(item => item.selected)\n\t\t\t.reduce((total, item) => total + item.price * item.quantity, 0);\n\t}\n\n\t// 获取选中的商品列表\n\tgetSelectedItems() {\n\t\treturn this.cartItems.filter(item => item.selected);\n\t}\n\n\t// 获取所有购物车商品\n\tgetCartItems() {\n\t\treturn this.cartItems;\n\t}\n\n\t// 检查是否全选\n\tisAllSelected() {\n\t\treturn this.cartItems.length > 0 && this.cartItems.every(item => item.selected);\n\t}\n\n\t// 通知购物车更新（用于页面间通信）\n\tnotifyCartUpdate() {\n\t\t// 发送自定义事件通知购物车更新\n\t\tuni.$emit('cartUpdated', {\n\t\t\ttotalCount: this.getTotalCount(),\n\t\t\tselectedCount: this.getSelectedCount(),\n\t\t\ttotalPrice: this.getSelectedTotalPrice(),\n\t\t\titems: this.cartItems\n\t\t});\n\t}\n\n\t// 根据商品ID查找商品\n\tfindItemById(productId) {\n\t\treturn this.cartItems.find(item => item.id === productId);\n\t}\n\n\t// 获取商品在购物车中的数量\n\tgetItemQuantity(productId) {\n\t\tconst item = this.findItemById(productId);\n\t\treturn item ? item.quantity : 0;\n\t}\n}\n\n// 创建全局购物车实例\nconst cartStore = new CartStore();\n\nexport default cartStore; "],"names":["uni"],"mappings":"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"}